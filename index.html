<!DOCTYPE html>
<html>
  <head>
    <title>Gemini Chat App</title>
    <link rel="stylesheet" href="index.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script type="importmap">
      {
        "imports": {
          "@google/genai": "https://esm.sh/@google/genai@^0.7.0",
          "marked": "https://esm.sh/marked@^15.0.7"
        }
      }
    </script>
  </head>
  <body>
    <header id="app-header" class="hidden">
      <div id="header-left">
        <button id="settings-button" aria-label="Settings">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 0 2.73l-.15.08a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1 0-2.73l.15.1a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg>
        </button>
        <button id="clear-chat-button" aria-label="Clear Chat">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"></path><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
        </button>
      </div>
      <div id="user-info"></div>
      <button id="logout-button">Logout</button>
    </header>

    <div id="auth-modal" class="hidden">
      <div class="modal-content">
        <h2 id="auth-title">Login</h2>
        <p id="auth-subtitle">Welcome back! Please enter your credentials.</p>
        <div id="auth-error" class="error-message hidden"></div>
        <form id="auth-form">
          <input type="text" id="username-input" placeholder="Username" required autocomplete="username" />
          <input type="password" id="password-input" placeholder="Password" required autocomplete="current-password" />
          <button type="submit" id="auth-button">Login</button>
        </form>
        <p id="auth-toggle-link">Don't have an account? <a href="#">Sign Up</a></p>
      </div>
    </div>
    
    <div id="settings-modal" class="hidden">
        <div class="modal-content">
            <h2>Settings</h2>
            <form id="settings-form">
                <label for="system-instruction-input">System Instruction</label>
                <p>Define custom behavior for the model that persists across your conversation.</p>
                <textarea id="system-instruction-input" placeholder="e.g., You are a helpful assistant that always responds in rhyme."></textarea>
                <div class="modal-actions">
                    <button type="button" id="settings-cancel-button">Cancel</button>
                    <button type="submit">Save</button>
                </div>
            </form>
        </div>
    </div>


    <div id="chat-container">
      <main id="chat-history">
        <!-- Welcome screen, shown only at the start -->
        <div id="welcome-screen">
          <div class="logo">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M12 2.5C12.4142 2.5 12.75 2.83579 12.75 3.25V5.75C12.75 6.16421 12.4142 6.5 12 6.5C11.5858 6.5 11.25 6.16421 11.25 5.75V3.25C11.25 2.83579 11.5858 2.5 12 2.5ZM6.25 6.5C6.66421 6.5 7 6.16421 7 5.75L7 4.5C7 4.08579 6.66421 3.75 6.25 3.75C5.83579 3.75 5.5 4.08579 5.5 4.5L5.5 5.75C5.5 6.16421 5.83579 6.5 6.25 6.5ZM17.75 6.5C18.1642 6.5 18.5 6.16421 18.5 5.75L18.5 4.5C18.5 4.08579 18.1642 3.75 17.75 3.75C17.3358 3.75 17 4.08579 17 4.5L17 5.75C17 6.16421 17.3358 6.5 17.75 6.5ZM3.25 12.75H5.75C6.16421 12.75 6.5 12.4142 6.5 12C6.5 11.5858 6.16421 11.25 5.75 11.25H3.25C2.83579 11.25 2.5 11.5858 2.5 12C2.5 12.4142 2.83579 12.75 3.25 12.75ZM18.25 12.75H20.75C21.1642 12.75 21.5 12.4142 21.5 12C21.5 11.5858 21.1642 11.25 20.75 11.25H18.25C17.8358 11.25 17.5 11.5858 17.5 12C17.5 12.4142 17.8358 12.75 18.25 12.75ZM12 17.5C11.5858 17.5 11.25 17.8358 11.25 18.25V20.75C11.25 21.1642 11.5858 21.5 12 21.5C12.4142 21.5 12.75 21.1642 12.75 20.75V18.25C12.75 17.8358 12.4142 17.5 12 17.5ZM6.25 17.5C5.83579 17.5 5.5 17.8358 5.5 18.25L5.5 19.5C5.5 19.9142 5.83579 20.25 6.25 20.25C6.66421 20.25 7 19.9142 7 19.5L7 18.25C7 17.8358 6.66421 17.5 6.25 17.5ZM17.75 17.5C17.3358 17.5 17 17.8358 17 18.25L17 19.5C17 19.9142 17.3358 20.25 17.75 20.25C18.1642 20.25 18.5 19.9142 18.5 19.5L18.5 18.25C18.5 17.8358 18.1642 17.5 17.75 17.5Z" fill="currentColor"/>
            </svg>
          </div>
          <h1>Hello, I'm Gemini</h1>
        </div>
        <!-- Chat messages will be appended here -->
      </main>
      <div id="chat-form-container">
         <button id="stop-button" class="hidden" aria-label="Stop generating">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect></svg>
            Stop generating
         </button>
        <form id="chat-form">
          <div id="image-preview-container" class="hidden">
            <img id="image-preview" src="#" alt="Image preview" />
            <button type="button" id="remove-image-button" aria-label="Remove image">&times;</button>
          </div>
          <div class="input-wrapper">
            <input type="file" id="file-input" accept="image/*" class="hidden" />
            <button type="button" id="attach-file-button" aria-label="Attach file">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path></svg>
            </button>
             <textarea id="chat-input" placeholder="Enter a prompt here" autocomplete="off" aria-label="Chat input" rows="1"></textarea>
             <button type="button" id="mic-button" aria-label="Use microphone">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="22"></line></svg>
             </button>
             <button type="submit" aria-label="Send message">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="19" x2="12" y2="5"></line><polyline points="5 12 12 5 19 12"></polyline></svg>
             </button>
          </div>
        </form>
        <div class="footer-info">
          Gemini may display inaccurate info, including about people, so double-check its responses.
        </div>
      </div>
    </div>
    <script type="module" src="index.tsx"></script>
  </body>
</html>